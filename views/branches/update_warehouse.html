{{extend 'base/layout.html'}}

{{block scripts_extra}}
<script type="text/javascript" src="{{=URL('static', 'js/plugins/jquery.validate.min.js')}}"></script>	
<script type="text/javascript" src="{{=URL('static', 'js/plugins/chosen.jquery.min.js')}}"></script>

<script type="text/javascript">
jQuery(document).ready(function() {
  console.log('done');
});
</script>
{{end}}

{{block sidebar_menu}}
{{include 'branches/sidebar.html'}}
{{end}}

{{block content}}
    <div class="centercontent">
    
        <div class="pageheader">
        
            <h1 class="pagetitle">{{=title}}</h1>
            
        </div><!--pageheader-->
        
        <div id="contentwrapper" class="contentwrapper">
        
        	<div id="validation" class="subcontent">
            	
            		<div class="contenttitle2">
                        <h3>Editar almacén</h3>
                    </div><!--contenttitle-->
            				
            		<div class="notibar msgerror" style="display:none;">
                    	<a class="close"></a>
                    	<p>Ocurrió un error con los datos del formulario.</p>
                    </div>

                    <div class="notibar exists" style="display:none;">
                    	<a class="close"></a>
                    	<p>Ese proveedor existe, para editarlo vaya a la sección de ver proveedor. </p>
                    </div>

                    <div class="notibar msgsuccess" style="display:none;">
                        <a class="close"></a>
                        <p>Se han guardado los datos del formulario.</p>
                    </div>		
            						
                    <form id="form_warehouse" class="stdform stdform2" method="post" action="">
                    	
	                    <p>
	                       	<label>Nombre</label>
	                        <span class="field"><input type="text" name="name" id="name" class="smallinput"/></span>
	                    </p>
	                    
	                    <div class="contenttitle2">
                        <h3>Domicilio</h3>
                        </div>  
	                     
	                    <p style="border-top: 1px #ddd solid;">
	                       	<label>Dirección</label>
	                        <span class="field"><input type="text" name="address" id="address" class="smallinput"/></span>
	                    </p>
	                    <p>
	                       	<label>Colonia</label>
	                        <span class="field"><input type="text" name="suburb" id="suburb" class="smallinput"/></span>
	                    </p>
	                    <p style="margin-top: 1px;">
                            <label>Estado</label>
                            <span class="field">
                                <!-- <select name="states" id="states">
                                </select> -->
                                <select id="states" name="states" data-placeholder="Seleccionar" class="chzn-select" style="width:350px;" tabindex="3">
                                  </select>
                            </span>
                        </p>
	                    <p style="margin-top: 1px;">
                            <label>Municipio</label>
                            <span id="municipality_container"class="field">
                            <select name="municipality" id="municipality" data-placeholder="Seleccionar" class="chzn-select" style="width:350px;" tabindex="4">
                            </select>
                            </span>
                        </p>
	                    <p style="margin-top: 1px;">
                            <label>Población</label>
                            <span class="field" id="locality_container">
                            <select name="locality" id="locality" data-placeholder="Seleccionar" class="chzn-select" style="width:350px;" tabindex="5">
                            </select>
                            </span>
                        </p>
 	                    <p style="margin-top: 1px;">
                            <label>Código postal</label>
                            <span class="field"><input type="text" name="zip_code" id="zip_code" class="smallinput" maxlength="5" tabindex="6"/></span>
                        </p>
	                                            
	                    <p class="stdformbutton">
                        	<button id="submit" class="submit radius2">Guardar</button>
                        </p>
                    </form>

            </div><!--subcontent-->     
        
        </div><!--contentwrapper-->
        
        <br clear="all" />
        
	</div><!-- centercontent -->   
    
</div><!--bodywrapper-->

<script type="text/javascript">
//////////// Ajax for selects ////////////
    jQuery(".chzn-select").chosen();

    var state = jQuery('#states'),
        municipality = jQuery('#municipality'),
        locality = jQuery('#locality');
    var s = '',
        m = '',
        l = '';

//////////// get info ////////////
    jQuery.ajax({
        url: "{{=URL(c='vendors_ajax', f='get_vendor_information')}}",
        data: { id: "{{=id}}" },
        type: "POST",
        dataType:"json",
        success:function(data){
            //console.log(data);
            jQuery('#company').val(data.vendors['name']);
            jQuery('#address').val(data.vendors['address']);
            jQuery('#zip_code').val(data.vendors['zip_code']);
            jQuery('#rfc').val(data.vendors['rfc']);
            jQuery('#website').val(data.vendors['website']);
            s = data.vendors['state_id'];
            m = data.vendors['municipality_id'];
            l = data.vendors['locality_id'];
            selectS(s);
            selectM(s, m);
            selectL(m, l); 
        }
    });

//////////// get municipalities ////////////
    state.change( function() {
        var id = jQuery(this).find(':selected').val();
        if(id != '') {
            jQuery.ajax({
                type: "POST",
                url: "{{=URL(c='common', f='get_municipalities')}}",
                data: {id: id},
                success: function(results) {
                    municipality
                        .html(results)
                        .prepend('<option value="">Seleccionar</option>')
                        .trigger("liszt:updated");
                    locality
                        .html('')
                        .prepend('<option value="">Seleccionar</option>')
                        .trigger("liszt:updated");
                }
            });
        }
        else {
            municipality
                .html('')
                .prepend('<option value="">Seleccionar</option>')
                .trigger("liszt:updated");
            locality
                .html('')
                .prepend('<option value="">Seleccionar</option>')
                .trigger("liszt:updated");
        }
    });

//////////// get localities ////////////
    municipality.change( function() {
        var id = jQuery(this).find(':selected').val();
        if(id != '') {
            jQuery.ajax({
                type: "POST",
                data: {municipality_id: id},
                url: "{{=URL(c='common', f='get_localities')}}",
                success: function(results) {
                    locality
                        .html(results)
                        .prepend('<option value="">Seleccionar</option>')
                        .trigger("liszt:updated");
                }
            });
        }
        else {
            locality
                    .html('')
                    .prepend('<option value="">Seleccionar</option>')
                    .trigger("liszt:updated");
        }
    });

//////////// validate form ////////////
    jQuery("#form_warehouse").validate({
            rules: {
                name: "required",
                address : "required",
                colony : "required",
                states : "required",
                municipality : "required",
                locality : "required",
                zip_code: {
                    required: false,
                    digits: true,
                    minlength: 5
                }
            },
            messages: {
                name: "Ingrese el nombre de la surcursal",
                address: "Ingrese la dirección de la surcursal",
                colony: "Ingrese la colonia de la surcursal",
                states: "Ingrese el estado de la surcursal",
                municipality: "Ingrese el municipio de la surcursal",
                locality: "Ingrese la Población de la surcursal",
                zip_code: "Este campo debe tener 5 números.",
            }
    });    

</script>

</body>
</html>
{{end}}
