{{extend 'base/layout.html'}}

{{block scripts_extra}}
<script type="text/javascript" src="{{=URL('static', 'js/plugins/jquery.dataTables.min.js')}}"></script>
<script type="text/javascript" src="{{=URL('static', 'js/custom/tables.js')}}"></script>

<script type="text/javascript" src="{{=URL('static', 'js/custom/forms.js')}}"></script>
<script type="text/javascript" src="{{=URL('static', 'js/plugins/jquery.tagsinput.min.js')}}"></script>
<script type="text/javascript" src="{{=URL('static', 'js/plugins/charCount.js')}}"></script>
<script type="text/javascript" src="{{=URL('static', 'js/plugins/ui.spinner.min.js')}}"></script>
<script type="text/javascript" src="{{=URL('static', 'js/plugins/chosen.jquery.min.js')}}"></script>
<script type="text/javascript" src="{{=URL('static', 'js/plugins/jquery.validate.min.js')}}"></script>
{{end}}

{{block sidebar_menu}}
{{include 'products/sidebar.html'}}
{{end}}

{{block content}}
    <div class="centercontent">
    
        <div class="pageheader">
        
            <h1 class="pagetitle">{{=title}}</h1>
            
        </div><!--pageheader-->
        
        <div id="contentwrapper" class="contentwrapper">
            <table cellpadding="0" cellspacing="0" border="0" class="stdtable" id="table">
                <thead>
                    <tr>
                        <th class="head0">Nombre</th>
                        <th class="head1">Descripción </th>
                        <th class="head0">Estatus </th>
                        <th class="head1">&nbsp;</th>
                        
                    </tr>
                </thead>
                <tfoot>
                    <tr>
                        <th class="head0">Nombre</th>
                        <th class="head1">Descripción </th>
                        <th class="head0">Estatus </th>
                        <th class="head1">&nbsp;</th>
                        
                    </tr>
                </tfoot>
            </table>
        </div><!--contentwrapper-->
        
        <br clear="all" />
        
	</div><!-- centercontent -->
    
    
</div><!--bodywrapper-->

<script type="text/javascript">

    function quickEdit(){
        jQuery('.stdtable a.toggle').on("click", function(){                                
            //this is to hide current open quick view in a table 
            jQuery(this).parents('table').find('tr').each(function(){
                jQuery(this).removeClass('hiderow');
                if(jQuery(this).hasClass('togglerow'))
                    jQuery(this).remove();
            });
            
            var parentRow = jQuery(this).parents('tr');
            var numcols = parentRow.find('td').length + 1;              //get the number of columns in a table. Added 1 for new row to be inserted              
            var url = jQuery(this).attr('href');
            
            //this will insert a new row next to this element's row parent
            parentRow.after('<tr class="togglerow"><td colspan="'+numcols+'"><div class="toggledata"></div></td></tr>');
            
            var toggleData = parentRow.next().find('.toggledata');
            
            parentRow.next().hide();
            
            //get data from server
            jQuery.post(url,function(data){
                toggleData.append(data);                        //inject data read from server
                parentRow.next().fadeIn();                      //show inserted new row
                parentRow.addClass('hiderow');                  //hide this row to look like replacing the newly inserted row
                jQuery('input,select').uniform();
            });
                    
            return false;
        });

        jQuery('.stdtable input:checkbox').on("change", function(e){
            console.log(e.currentTarget.value);
            jQuery.ajax({
                url: "{{=URL(c='products_ajax', f='toggle_brand')}}",
                type: "POST",
                data: {
                    id:e.currentTarget.value
                },
                success: function(data){
                    console.log(data);
                }
            });
        })
    }

    jQuery.ajax({
        url: "{{=URL(c='products_ajax', f='get_brands')}}",
        type: "POST",
        dataType: "json",
        success:function(data){
            cont = 0;
            aaData = new Array();
            for(row in data){
                brand = data[row].brands;
                description = data[row].brand_descriptions;
                checked = (brand.status) ? "checked=\"checked\"" : "";
                aaData[cont] = [
                    description.name, 
                    description.description, 
                    "<input type=\"checkbox\" " + checked + " value=\"" + brand.id + "\" />", 
                    "<a href=\"{{=URL(c='products', f='brand_quickedit.html')}}?id=" + brand.id + "\" class=\"toggle\">Editar</a>"
                ];
                cont++;
            }
            jQuery("#table").dataTable( {
                "aaData": aaData,
                "aoColumns": [
                    {"sTitle":"Nombre"},
                    {"sTitle":"Descripción"},
                    {"sTitle":"Estatus", "sClass":"center"},
                    {"sTitle":"", "sClass":"center"}
                ]
            });
            quickEdit();
        }
    });
</script>

</body>
</html>
{{end}}
