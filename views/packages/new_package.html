{{extend 'base/layout.html'}}

{{block scripts_extra}}
<script type="text/javascript" src="{{=URL('static', 'js/plugins/jquery.maskedinput.js')}}"></script>
<script type="text/javascript" src="{{=URL('static', 'js/plugins/jquery.validate.min.js')}}"></script>
<script type="text/javascript" src="{{=URL('static', 'js/plugins/chosen.jquery.min.js')}}"></script>
<script type="text/javascript" src="{{=URL('static', 'js/plugins/jquery.dataTables.min.js')}}"></script>
<script type="text/javascript" src="{{=URL('static', 'js/custom/dualselector.js')}}"></script>
<script type="text/javascript" src="{{=URL('static', 'js/plugins/chosen.jquery.min.js')}}"></script>    
<style type="text/css">
    .ellol {
        border: 1px solid red;
    }    
</style>
{{end}}

{{block sidebar_menu}}
{{include 'packages/sidebar.html'}}
{{end}}

{{block content}}
    <div class="centercontent">
    
        <div class="pageheader">
        
            <h1 class="pagetitle">{{=title}}</h1>
            
        </div><!--pageheader-->
        
        <div id="contentwrapper" class="contentwrapper">
        
            <div id="validation" class="subcontent">
         
                    <div class="notibar msgerror" style="display:none;">
                        <a class="close"></a>
                        <p>Ocurrió un error con los datos del formulario.</p>
                    </div>

                    <div class="notibar exists" style="display:none;">
                        <a class="close"></a>
                        <p>Este paquete ya existe, para editarlo vaya a la sección de ver paquetes. </p>
                    </div>

                    <div class="notibar msgsuccess" style="display:none;">
                        <a class="close"></a>
                        <p>Se han guardado los datos del formulario.</p>
                    </div>
                
                    <form id="form_package" class="stdform stdform2" method="post" action="">                                       
                        <p>
                            <label>Nombre del Paquete*</label>
                            <span class="field"><input type="text" name="name" id="name" class="smallinput" tabindex="1"/></span>
                        </p>
                        <p>
                            <label>Costo estandar</label>
                            <span class="field">
                                <input type="text" name="standard_cost" id="standard_cost" class="smallinput" placeholder="0.00" tabindex="3"/>
                            </span>
                        </p>
                        <p>
                            <label>Margen de utilidad</label>
                            <span class="field"><input type="text" name="markup" id="markup" class="smallinput" tabindex="4"/></span>
                        </p>
                        <p>
                            <label>Descripción</label>
                            <span class="field">
                                <textarea cols="80" rows="5" name="description" id="description" class="smallinput" tabindex="5"></textarea>
                            </span>
                        </p>
                        <p class="stdformbutton">
                            <button id="submit" class="submit radius2" tabindex="6">Guardar</button>
                        </p>
                        <a href="{{=URL(c='packages', f='select_products')}}">ir</a>
                        
                        
                    </form>
                   

            </div><!--subcontent-->

        </div><!--contentwrapper-->
        
        <br clear="all" />
        
    </div><!-- centercontent -->
        
</div><!--bodywrapper-->

<script type="text/javascript">

//jQuery(".chzn-select").chosen();
    var product = jQuery('#products');
    var options;

///////// get products /////////
    get_products();
    function get_products() {
        jQuery.ajax({
            url: "{{=URL(c='products_ajax', f='get_products')}}",
            type: "POST",
            dataType: "json",
            success: function(data){
                if(data) {
                    for(d = 0; d < data.length; d++) {
                        options += '<option value='+data[d].product_descriptions.id+'>'+data[d].product_descriptions.name+'</option>';
                    }
                }
            },
            complete: function() {
                jQuery('#products').append(options);
                jQuery('#products').chosen();
            }
        });
    }

    jQuery("#form_package").validate({
            rules: {
                name: "required",
                standard_cost: {
                    number: true,
                    required: false
                },
                markup: {
                    number: true,
                    required: false
                },
            },
            messages: {
                name: "Ingrese el nombre del paquete",
                standard_cost: "Ingrese numeros decimales",
                markup: "Ingrese numeros decimales"
            }
        });

    //////////// send form ////////////                 
    jQuery('#submit').live('click', function(e) {
        e.preventDefault();
        
        jQuery('.msgerror').hide();
        jQuery('.exists').hide();
        jQuery('.msgsuccess').hide();

        if(jQuery("#form_package").valid()) {
             jQuery.ajax({
                url: "{{=URL(c='products_ajax', f='create_product')}}",
                data: { 
                    name:jQuery('#name').val(),
                    vendors:jQuery('#products').val() ? (jQuery('#products').val()) : '',
                    standard_cost:jQuery('#standard_cost').val(),
                    markup:jQuery('#markup').val(),
                    description:jQuery('#description').val(),
                },
                type: 'POST',
                success:function(data){
                    if(data != 0 && data){
                        jQuery('.msgsuccess').fadeIn(1600, function() {
                            jQuery('.msgsuccess').fadeOut('slow');
                        });
                        deleteFields();
                    }
                    else if(data == 0) {
                        jQuery('.exists').fadeIn(1600);
                    }
                    else{
                        jQuery('.msgerror').fadeIn(1600);
                    }
                    jQuery('body','html',window).animate(
                                                        {scrollTop:0}, 
                                                        1000);
                }
            }); 
        } else {
            jQuery('.msgerror').fadeIn(1600);
            jQuery('body','html',window, document).animate({scrollTop:0},1000);
        }
    });

///////////// Borrar campos /////////////

    function deleteFields() {
        jQuery('#name').val('');
        jQuery('#products')
            .find('option')
            .first()
            .attr('selected',true)
            .trigger("liszt:updated");
        jQuery('#standard_cost').val('');
        jQuery('#markup').val('');
        jQuery('#description').val('');
    }
 
    


</script>
</body>
</html>
{{end}}
